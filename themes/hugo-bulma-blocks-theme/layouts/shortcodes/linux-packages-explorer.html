{{ $distribution := .Get "distribution" }}
{{ $distributionKey := replace $distribution "-" "_" }}
{{ $linuxPackagesData := $.Site.Data.downloads.linux_packages }}
{{ $data := index $linuxPackagesData $distributionKey }}

{{ $coreJs := resources.Get "js/s3-file-explorer-core.js" }}
{{ if $coreJs }}
<script src="{{ $coreJs.RelPermalink }}"></script>
{{ end }}

{{ $js := resources.Get "js/linux-packages-explorer.js" }}
{{ if $js }}
<script src="{{ $js.RelPermalink }}" defer></script>
{{ end }}

{{ if not $data }}
<div class="notification is-danger">
    <p><strong>Error:</strong> Distribution "{{ $distribution }}" not found.</p>
    <p>Please make sure the data file exists at <code>data/downloads/linux_packages/{{ $distribution }}.json</code></p>
</div>
{{ else }}


<!-- Breadcrumb Navigation -->
<nav class="breadcrumb mt-4 mb-4" aria-label="breadcrumbs" id="linux-breadcrumb">
    <ul>
        <li class="is-active">
            <a href="#" aria-current="page">
                <span class="icon is-small"><i class="fas fa-home"></i></span>
                <span>Home</span>
            </a>
        </li>
    </ul>
</nav>

<!-- File List View -->
<div id="linux-list-view" class="s3-list-container">
    <div class="table-container">
        <table class="table is-fullwidth is-hoverable is-striped">
            <thead>
                <tr>
                    <th class="sortable" data-sort="name">
                        Name
                        <span class="icon is-small sort-icon">
                            <i class="fas fa-sort"></i>
                        </span>
                    </th>
                    <th class="is-hidden-mobile sortable" data-sort="size">
                        Size
                        <span class="icon is-small sort-icon">
                            <i class="fas fa-sort"></i>
                        </span>
                    </th>
                    <th class="is-hidden-mobile sortable" data-sort="date">
                        Modified
                        <span class="icon is-small sort-icon">
                            <i class="fas fa-sort"></i>
                        </span>
                    </th>
                </tr>
            </thead>
            <tbody id="linux-files-tbody">
                <!-- Files and folders will be rendered here by JavaScript -->
            </tbody>
        </table>
    </div>
</div>

<!-- Results Info Bar -->
<div class="s3-results-info mt-4" id="linux-results-info">
    <div class="level is-mobile">
        <div class="level-left">
            <div class="level-item">
                <span>Showing <strong id="linux-results-count">0</strong> items</span>
            </div>
        </div>
    </div>
</div>

<!-- No Results Message -->
<div id="linux-no-results" class="s3-no-results" style="display: none;">
    <p class="mb-4">
        <span class="icon is-large has-text-grey-lighter">
            <i class="fas fa-folder-open fa-3x"></i>
        </span>
    </p>
    <p class="title is-5 has-text-grey">No items found</p>
    <p class="subtitle is-6 has-text-grey-light">This folder is empty</p>
</div>

<script>
// Initialize the Linux Packages Explorer with tree data
document.addEventListener('DOMContentLoaded', function() {
    if (typeof initLinuxPackagesExplorer === 'function') {
        initLinuxPackagesExplorer({
            tree: {{ $data.tree | jsonify }},
            totalFiles: {{ $data.statistics.total_files }}
        });
    } else {
        console.error('Linux Packages Explorer: initLinuxPackagesExplorer function not found');
    }
});
</script>
{{ end }}
