<div class="container">
    <div class="roadmap  mb-4">
        {{ with index .Site.Data.conf }}
            <div class="right-ribbon"><span class="stable">Current: {{ .ltrrelease }}</span></div>
        {{ end }}
    <h3 class="title">Long Term Release (LTR)</h3>
    <ul class="steps is-balanced">
        <li class="steps-segment">
            <span class="steps-marker"></span>
            <div class="steps-content">
            <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                <span>
                    Initial Release 
                </span>
                <span class="help-tip">
                    <span>Our stable releases are created by periodically taking a development version and 'hardening' it by focussing only on bugfixes. </span>
                 </span>
            </div>
            
        </li>
        <li class="steps-segment is-active">
            <span class="steps-marker"></span>
            <div class="steps-content">
                <div>
                    <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                        <span>
                            Point Release:
                            {{ with index .Site.Data.conf }}
                                <span class="rm-current">{{ .next_ltr_version }}</span>
                            {{ end }}
                        </span>
                        <span class="help-tip">
                            <span>Each month we create a new point release for our stable version. These releases contain no new features, only bug fixes. </span>
                        </span>
                    </div>
                    <nav id="point-release" class="level">
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                                <p class="days heading is-size-7 tag "></p>
                                <p class="is-size-7"> Days  </p>
                            </div>
                        </div>
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                            <p class="hours heading is-size-7 tag "></p>
                            <p class="is-size-7"> Hours </p>
                            </div>
                        </div>
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                                <p class="minutes heading is-size-7 tag "></p>
                                <p class="is-size-7">Min.</p>
                            </div>
                        </div>
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                                <p class="seconds heading is-size-7 tag "></p>
                                <p class="is-size-7">Sec.</p>
                            </div>
                        </div>

                        <button id="addPrToCalendar" class="button is-small is-light" title="Add to Calendar">
                            <span class="icon is-small">
                                <i class="fas fa-calendar"></i>
                            </span>
                        </button>
                    </nav>
                </div>
            </div>
        </li>
        <li class="steps-segment is-active">
            <span class="steps-marker"></span>
            <div class="steps-content">
                <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                    <span>Packaging</span>
                    <span class="help-tip">
                        <span>Here we tag the release and make it available for packaging on different platforms. </span>
                    </span>
                </div>
            </div>
        </li>
        <li class="steps-segment is-active">
            <span class="steps-marker"></span>
            <div class="steps-content">
                <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                    <span>Installers available</span>
                    <span class="help-tip">
                        <span>The exact period between packaging and the availablility of installers varies by platform as maintainers prepare their packages. See the download pages for updates on availability.</span>
                    </span>
                </div>
            </div>
        </li>
    </ul>
    </div>

    <div class="roadmap  mb-4">
    {{ with index .Site.Data.conf }}
        <div class="right-ribbon"><span class="latest">Current: {{ .release }}</span></div>
    {{ end }}
    <h3 class="title">Latest Release</h3>
    <ul class="steps is-balanced">
        <li class="steps-segment">
            <span class="steps-marker"></span>
            <div class="steps-content">
            <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                <span>
                    Initial Release 
                </span>
                <span class="help-tip">
                    <span>Our stable releases are created by periodically taking a development version and 'hardening' it by focussing only on bugfixes. </span>
                 </span>
            </div>
            
        </li>
        <li class="steps-segment is-active">
            <span class="steps-marker"></span>
            <div class="steps-content">
                <div>
                    <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                        <span>
                            Point Release:
                            {{ with index .Site.Data.conf }}
                                <span class="rm-next">{{ .next_lr_version }}</span>
                            {{ end }}
                        </span>
                        <span class="help-tip">
                            <span>Each month we create a new point release for our latest version. These releases contain no new features, only bug fixes. </span>
                        </span>
                    </div>
                    <nav id="latest-point-release" class="level">
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                                <p class="days heading is-size-7 tag "></p>
                                <p class="is-size-7"> Days  </p>
                            </div>
                        </div>
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                            <p class="hours heading is-size-7 tag "></p>
                            <p class="is-size-7"> Hours </p>
                            </div>
                        </div>
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                                <p class="minutes heading is-size-7 tag "></p>
                                <p class="is-size-7">Min.</p>
                            </div>
                        </div>
                        <div class="level-item is-narrow has-text-centered">
                            <div>
                                <p class="seconds heading is-size-7 tag "></p>
                                <p class="is-size-7">Sec.</p>
                            </div>
                        </div>
                        <button id="addLatestPrToCalendar" class="button is-small is-light" title="Add to Calendar">
                            <span class="icon is-small">
                                <i class="fas fa-calendar"></i>
                            </span>
                        </button>
                    </nav>
                </div>
            </div>
        </li>
        <li class="steps-segment is-active">
            <span class="steps-marker"></span>
            <div class="steps-content">
                <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                    <span>Packaging</span>
                    <span class="help-tip">
                        <span>Here we tag the release and make it available for packaging on different platforms. </span>
                    </span>
                </div>
            </div>
        </li>
        <li class="steps-segment is-active">
            <span class="steps-marker"></span>
            <div class="steps-content">
                <div class=" has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                    <span>Installers available</span>
                    <span class="help-tip">
                        <span>The exact period between packaging and the availablility of installers varies by platform as maintainers prepare their packages. See the download pages for updates on availability.</span>
                    </span>
                </div>
            </div>
            </li>
    </ul>
    </div>

    <div class="roadmap  mb-6">
        {{ with index .Site.Data.conf }}
            <div class="right-ribbon"><span class="development">Future: {{ .nextversion }}</span></div>
        {{ end }}
        <h3 class="title">Development Version</h3>
        <ul class="steps is-balanced">
            <li class="steps-segment">
                <span class="steps-marker"></span>
                <div class="steps-content">
                <div class=" has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                    <span>Active development</span>
                    <span class="help-tip">
                        <span>This is the open stage for accepting new features.</span>
                    </span>
    
                </div>
                </div>
            </li>
            <li class="steps-segment">
                <span class="steps-marker"></span>
                <div class="steps-content">
                    <div>
                        <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                            <span>
                                Feature freeze:
                                {{ with index .Site.Data.conf }}
                                    <span class="rm-future">{{ .devversion }}</span>
                                {{ end }}
                            </span>
                            <span class="help-tip">
                                <span>During feature freeze, no new features are accepted, only bug fixes and code clean ups.</span>
                            </span>
                        </div>
                        <nav id="freeze" class="level">
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                    <p class="days heading is-size-7 tag "></p>
                                    <p class="is-size-7">Days</p>
                                </div>
                            </div>
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                <p class="hours heading is-size-7 tag "></p>
                                <p class="is-size-7">Hours</p>
                                </div>
                            </div>
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                    <p class="minutes heading is-size-7 tag "></p>
                                    <p class="is-size-7">Min.</p>
                                </div>
                            </div>
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                    <p class="seconds heading is-size-7 tag "></p>
                                    <p class="is-size-7">Sec.</p>
                                </div>
                            </div>
                            <button id="addFreezeToCalendar" class="button is-small is-light" title="Add to Calendar">
                                <span class="icon is-small">
                                    <i class="fas fa-calendar"></i>
                                </span>
                            </button>
                        </nav>
                    </div>
                </div>
            </li>
            <li class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                    <div class=" has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                        <span>
                            Point Release:
                            {{ with index .Site.Data.conf }}
                                <span class="rm-future">{{ .nextversion }}</span>
                            {{ end }}
                        </span>
                        <span class="help-tip">
                            <span>The freeze ends with a new release that is branched off and a new development cycle begins.</span>
                        </span>
                    </div>
                    <div>
                        <nav id="package" class="level">
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                    <p class="days heading is-size-7 tag "></p>
                                    <p class="is-size-7">Days</p>
                                </div>
                            </div>
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                <p class="hours heading is-size-7 tag "></p>
                                <p class="is-size-7">Hours</p>
                                </div>
                            </div>
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                    <p class="minutes heading is-size-7 tag "></p>
                                    <p class="is-size-7">Min.</p>
                                </div>
                            </div>
                            <div class="level-item is-narrow has-text-centered">
                                <div>
                                    <p class="seconds heading is-size-7 tag "></p>
                                    <p class="is-size-7">Sec.</p>
                                </div>
                            </div>
                            <button id="addPackageToCalendar" class="button is-small is-light" title="Add to Calendar">
                                <span class="icon is-small">
                                    <i class="fas fa-calendar"></i>
                                </span>
                            </button>
                        </nav>
                    </div>
                </div>
            </li>

            <li class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                    <div class="has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                        <span>Packaging</span>
                        <span class="help-tip">
                            <span>Here we tag the release and make it available for packaging on different platforms. </span>
                        </span>
                    </div>
                </div>
            </li>
            <li class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                    <div class=" has-text-weight-normal is-flex is-flex-direction-row-reverse is-justify-content-left is-align-items-center">
                        <span>Installers available</span>
                        <span class="help-tip">
                            <span>The exact period between packaging and the availablility of installers varies by platform as maintainers prepare their packages. See the download pages for updates on availability.</span>
                        </span>
                    </div>
                </div>
                </li>
        </ul>
        </div>
</div>
<script>
    /** Script graciously provided at https://codepen.io/SitePoint/pen/MwNPVq */
    function getTimeRemaining(endtime) {
        var t = Date.parse(endtime) - Date.parse(new Date());
        var seconds = Math.floor((t / 1000) % 60);
        var minutes = Math.floor((t / 1000 / 60) % 60);
        var hours = Math.floor((t / (1000 * 60 * 60)) % 24);
        var days = Math.floor(t / (1000 * 60 * 60 * 24));
        return {
          'total': t,
          'days': days,
          'hours': hours,
          'minutes': minutes,
          'seconds': seconds
        };
      }
      
      function initializeClock(id, endtime) {
        var clock = document.getElementById(id);
        var daysSpan = clock.querySelector('.days');
        var hoursSpan = clock.querySelector('.hours');
        var minutesSpan = clock.querySelector('.minutes');
        var secondsSpan = clock.querySelector('.seconds');
      
        function updateClock() {
          var t = getTimeRemaining(endtime);
      
          if (t.total <= 0) {
            clearInterval(timeinterval);
            // Hide the counter when the date is reached
            clock.innerHTML = ''
          } else {
            daysSpan.innerHTML = t.days;
            hoursSpan.innerHTML = ('0' + t.hours).slice(-2);
            minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
            secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);
          }
        }
      
        updateClock();
        var timeinterval = setInterval(updateClock, 1000);
      }
      
      {{ with index .Site.Data.conf }}
        let nextFreezeDateStr = {{ .nextfreezedate }};
        let nextReleaseDateStr = {{ .nextreleasedate }};
        let nextPointReleaseDateStr = {{ .nextpointreleasedate }};
        let nextLtrVersion = {{ .next_ltr_version }};
        let nextLrVersion = {{ .next_lr_version }};
        let devVersion = {{ .devversion }};
        let nextVersion = {{ .nextversion }};

      {{ end }}
      //   We need to correct the date string format for Safari otherwise it will return NaN
      const nextFreezeDate = new Date(nextFreezeDateStr.replace(" ", "T").replace(" UTC", "Z"))
      const nextReleaseDate = new Date(nextReleaseDateStr.replace(" ", "T").replace(" UTC", "Z"))
      const nextPointReleaseDate = new Date(nextPointReleaseDateStr.replace(" ", "T").replace(" UTC", "Z"))

      initializeClock('point-release', nextPointReleaseDate);
      initializeClock('latest-point-release', nextPointReleaseDate);
      initializeClock('freeze', nextFreezeDate);
      initializeClock('package', nextReleaseDate);

      function createiCalendar(event) {
        // Format the date/time in the iCalendar format (UTC)
        const formatDate = (date) =>
          date.toISOString().replace(/-|:|\.\d+/g, "");
        // Create the iCalendar file content
        const icsContent = `
BEGIN:VCALENDAR
VERSION:2.0
BEGIN:VEVENT
SUMMARY:${event.title}
DTSTART:${formatDate(event.start)}
DTEND:${formatDate(event.end)}
END:VEVENT
END:VCALENDAR
        `.trim();

        // Create a blob and a download link
        const blob = new Blob([icsContent], { type: "text/calendar" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "event.ics";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    function addEventToCalendar(buttonId, eventTitle, eventDate) {
      document.getElementById(buttonId).addEventListener("click", () => {
        const event = {
            title: eventTitle,
            start: eventDate,
            end: eventDate,
        };
        createiCalendar(event);
      });
    }

    addEventToCalendar("addPrToCalendar", `QGIS Point Release ${nextLtrVersion}`, nextPointReleaseDate);
    addEventToCalendar("addLatestPrToCalendar", `QGIS Point Release ${nextLrVersion}`, nextPointReleaseDate);
    addEventToCalendar("addFreezeToCalendar", `QGIS Feature Freeze ${devVersion}`, nextFreezeDate);
    addEventToCalendar("addPackageToCalendar", `QGIS Release ${nextVersion}`, nextReleaseDate);
    </script>
