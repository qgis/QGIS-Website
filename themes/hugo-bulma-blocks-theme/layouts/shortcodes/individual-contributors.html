{{ $allContributors := $.Site.Data.contributors.contributors.contributors }}
{{ $honoraryMembers := $.Site.Data.contributors.honorary_members }}
{{ $contributors := slice }}
{{ range $allContributors }}
    {{ if .has_github_account }}
        {{ $contributors = $contributors | append . }}
    {{ end }}
{{ end }}
{{ $contributors = sort $contributors "total_contributions" "desc" }}

<!-- Filter and Search Section -->
<div class="contributors-filter-section notification is-light p-5 mb-5">
    <!-- Search Bar -->
    <div class="field mb-5">
        <div class="control has-icons-left is-large">
            <input 
                class="input is-medium" 
                type="text" 
                id="contributor-search" 
                placeholder="Search contributors by GitHub username..."
                aria-label="Search contributors"
            >
            <span class="icon is-left is-large">
                <i class="fas fa-search"></i>
            </span>
        </div>
    </div>

    <!-- Filters -->
    <div class="mb-4">
        <div class="has-text-weight-semibold has-text-grey-dark mb-3 is-uppercase">
            <span class="icon-text">
                <span class="icon"><i class="fas fa-filter"></i></span>
                <span>Filter by Contribution Area</span>
            </span>
        </div>
        <div class="buttons">
            <button class="button filter-button" data-thematic="qgis_core">
                <span class="icon"><i class="fas fa-code"></i></span>
                <span>QGIS Core</span>
            </button>
            <button class="button filter-button" data-thematic="documentation">
                <span class="icon"><i class="fas fa-book"></i></span>
                <span>Documentation</span>
            </button>
            <button class="button filter-button" data-thematic="web_sites">
                <span class="icon"><i class="fas fa-globe"></i></span>
                <span>Web Sites</span>
            </button>
        </div>
    </div>

    <!-- Stats and Reset -->
    <div class="level is-mobile">
        <div class="level-left">
            <div class="level-item">
                <div>
                    <span class="has-text-grey-dark">Showing:</span>
                    <span id="stats-showing" class="has-text-weight-semibold">{{ len $contributors }}</span>
                </div>
            </div>
            <div class="level-item">
                <div>
                    <span class="has-text-grey-dark">Total:</span>
                    <span id="stats-total" class="has-text-weight-semibold">{{ len $contributors }}</span>
                </div>
            </div>
        </div>
        <div class="level-right">
            <div class="level-item">
                <button class="button is-outlined is-primary3" id="reset-filters">
                    <span class="icon"><i class="fas fa-redo"></i></span>
                    <span>Reset Filters</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- No Results Message (hidden by default) -->
<div class="contributors-no-results notification has-text-centered py-6" style="display: none;">
    <span class="icon is-large has-text-grey-lighter mb-4">
        <i class="fas fa-search-minus fa-3x"></i>
    </span>
    <h3 class="title is-4 has-text-grey">No contributors found matching your criteria</h3>
    <p class="has-text-grey">Try adjusting your search terms or selected filters to see more results</p>
</div>

<!-- Contributors Grid -->
<div class="columns is-multiline is-flex">
    {{ range $idx, $contributor := $contributors }}
    {{ $isHonorary := index $honoraryMembers $contributor.login }}
    <div class="column is-one-third-fullhd is-half-tablet is-full-mobile">
        <div class="card contributor-card individual{{ if $isHonorary }} honorary-member{{ end }}" id="{{ .login | urlize }}">
            <div class="card-content has-text-centered">
                <div class="avatar-container">
                    <img src="{{ $contributor.avatar_url }}" alt="{{ $contributor.login }}" class="avatar" loading="lazy">
                    <span class="level-indicator level-5 p-1"># {{ add $idx 1 }}</span>
                    {{ if $isHonorary }}
                    <span class="honorary-badge">{{ $isHonorary.icon }}</span>
                    {{ end }}
                </div>
                {{ if $isHonorary }}
                <div class="honorary-info">
                    <p class="is-size-6 has-text-grey">{{ $isHonorary.title }}</p>
                </div>
                {{ end }}
                <h3 class="title is-4">
                    <a class="heading-anchor" href="#{{ .login | urlize }}" style="margin-left: -22.3px;">
                        Â¶
                    </a>
                    <a href="https://github.com/{{ .login }}" class="external-link" target="_blank" rel="noopener">
                        {{ .login }}
                    </a>
                </h3>

                <div class="total-contributions mb-4 is-flex is-justify-content-center is-align-items-center">
                    <span class="tag is-light is-medium has-text-weight-semibold mr-1 is-rounded">
                        <i class="fab fa-git-alt mr-1 has-text-info"></i>
                        {{ .total_contributions }}
                    </span>
                    <span class="has-text-grey">commits</span>
                </div>
                <div class="contribution-badges">
                        {{ $thematicList := slice }}
                        {{ range $k, $v := .thematics }}
                            {{ $thematicList = $thematicList | append (dict "name" $k "count" $v) }}
                        {{ end }}
                        {{ $sorted := sort $thematicList "count" "desc" }}
                        {{ range $item := $sorted }}
                            {{ $thematic := $item.name }}
                            {{ $count := $item.count }}
                            {{ if gt $count 0 }}
                                <span class="contributor-badge contributor-badge-{{ $thematic }}">
                                    <span>
                                        {{ if eq $thematic "documentation" }}<i class="fas fa-book mr-1"></i> QGIS Documentation{{ end }}
                                        {{ if eq $thematic "qgis_core" }}<i class="fas fa-code mr-1"></i> QGIS Core{{ end }}
                                        {{ if eq $thematic "web_sites" }}<i class="fas fa-globe mr-1"></i> QGIS Web Sites{{ end }}
                                        {{ if eq $thematic "community_activities" }}<i class="fas fa-users mr-1"></i> Community{{ end }}
                                        {{ if eq $thematic "qgis_infrastructure" }}<i class="fas fa-server mr-1"></i> Infrastructure{{ end }}
                                    </span>
                                    <span class="contribution-count">
                                        <i class="fab fa-git-alt"></i>
                                        {{ $count }}
                                    </span>
                                </span>
                            {{ end }}
                        {{ end }}
                </div>
            </div>
        </div>
    </div>
    {{ end }}
</div>

<!-- Load contributors filter functionality -->
{{ $js := resources.Get "js/contributors-filter.js" }}
<script src="{{ $js.RelPermalink }}"></script>